import random
import time
import numpy as np
import matplotlib.pyplot as plt
import comtypes
from comtypes.gen import STKUtil
from comtypes.gen import STKObjects
from comtypes.client import GetActiveObject
import cProfile, pstats, io

# 火焰图
pr = cProfile.Profile()
pr.enable()

# gobal parms
item_size = 500
gen = 200 - 94
cross_rate = 0.5
variation_rate = 0.4
totalTime = 27 * 24 * 60 * 60 + 7 * 60 * 60                 # 2358000
startTime = time.time()

print("---------------- begin STK init ----------------")
# init STK
uiApplication = GetActiveObject('STK10.Application')
uiApplication.Visible = False
root = uiApplication.Personality2
sc = root.CurrentScenario
sc2 = sc.QueryInterface(STKObjects.IAgScenario)

# 获取卫星
satTemp1 = sc.Children.Item('sat1')
sat1 = satTemp1.QueryInterface(STKObjects.IAgSatellite)
satTemp2 = sc.Children.Item('sat2')
sat2 = satTemp2.QueryInterface(STKObjects.IAgSatellite)
satTemp3 = sc.Children.Item('sat3')
sat3 = satTemp3.QueryInterface(STKObjects.IAgSatellite)

# 获取链路
chainTemp1 = sc.Children.Item("ChainChidao")
chain1 = chainTemp1.QueryInterface(STKObjects.IAgChain)
chainTemp2 = sc.Children.Item("ChainNanji")
chain2 = chainTemp2.QueryInterface(STKObjects.IAgChain)
chainTemp3 = sc.Children.Item("ChainYuebei")
chain3 = chainTemp3.QueryInterface(STKObjects.IAgChain)

# 获取卫星参数修改句柄
sat1.SetPropagatorType(STKObjects.ePropagatorJ4Perturbation)
J4Propagator1 = sat1.Propagator.QueryInterface(
    STKObjects.IAgVePropagatorJ4Perturbation)
keplerian1 = J4Propagator1.InitialState.Representation.ConvertTo(
    STKUtil.eOrbitStateClassical).QueryInterface(STKObjects.IAgOrbitStateClassical)
keplerian1.SizeShapeType = STKObjects.eSizeShapeSemimajorAxis
keplerian1.Orientation.AscNodeType = STKObjects.eAscNodeRAAN
keplerian1.LocationType = STKObjects.eLocationTrueAnomaly

sat2.SetPropagatorType(STKObjects.ePropagatorJ4Perturbation)
J4Propagator2 = sat2.Propagator.QueryInterface(
    STKObjects.IAgVePropagatorJ4Perturbation) 
keplerian2 = J4Propagator2.InitialState.Representation.ConvertTo(
    STKUtil.eOrbitStateClassical).QueryInterface(STKObjects.IAgOrbitStateClassical)
keplerian2.SizeShapeType = STKObjects.eSizeShapeSemimajorAxis
keplerian2.Orientation.AscNodeType = STKObjects.eAscNodeRAAN
keplerian2.LocationType = STKObjects.eLocationTrueAnomaly

sat3.SetPropagatorType(STKObjects.ePropagatorJ4Perturbation)
J4Propagator3 = sat3.Propagator.QueryInterface(
    STKObjects.IAgVePropagatorJ4Perturbation) 
keplerian3 = J4Propagator3.InitialState.Representation.ConvertTo(
    STKUtil.eOrbitStateClassical).QueryInterface(STKObjects.IAgOrbitStateClassical)
keplerian3.SizeShapeType = STKObjects.eSizeShapeSemimajorAxis
keplerian3.Orientation.AscNodeType = STKObjects.eAscNodeRAAN
keplerian3.LocationType = STKObjects.eLocationTrueAnomaly
print("---------------- finish STK init ----------------")


# def import_init_data():
#     data = []
#     fo = open("ga_good_init_data.txt", "r")
#     for line in fo:
#         line_data = line.split(" ")
#         line_data[-1] = line_data[-1][0 : -1]
#         line_data = list(map(float, line_data))
#         data.append(line_data[0 : 10])
#     fo.close()
#     np.random.shuffle(data) 
#     return data[0:item_size]


def modify(keplerian, a1, a2, a3, a4, a5, a6):
    # 半长轴长度
    keplerian.SizeShape.QueryInterface(STKObjects.IAgClassicalSizeShapeSemimajorAxis).SemiMajorAxis = a1
    # 偏心率
    keplerian.SizeShape.QueryInterface(STKObjects.IAgClassicalSizeShapeSemimajorAxis).Eccentricity = np.sqrt((1-5/3*np.cos(a3/180*np.pi)*np.cos(a3/180*np.pi)))
    # degrees 倾角
    keplerian.Orientation.Inclination = a3
    # degrees 近地点
    keplerian.Orientation.ArgOfPerigee = a4
    # RANN 设置轨道位置
    keplerian.Orientation.AscNode.QueryInterface(STKObjects.IAgOrientationAscNodeRAAN).Value = a5
    # 设置卫星在该轨道中的“相位”
    keplerian.Location.QueryInterface(STKObjects.IAgClassicalLocationTrueAnomaly).Value = a6


def cal(group, scores):
    for i in range(item_size):
        # 调整
        modify(keplerian1, 6500, 0, group[i][0], group[i][1], group[i][2], 0)
        sat1.Propagator.QueryInterface(
            STKObjects.IAgVePropagatorJ4Perturbation).InitialState.Representation.Assign(keplerian1)
        sat1.Propagator.QueryInterface(
            STKObjects.IAgVePropagatorJ4Perturbation).Propagate()
        modify(keplerian2, 6500, 0, group[i][0], group[i][1], group[i][2], group[i][3])
        sat2.Propagator.QueryInterface(
            STKObjects.IAgVePropagatorJ4Perturbation).InitialState.Representation.Assign(keplerian2)
        sat2.Propagator.QueryInterface(
            STKObjects.IAgVePropagatorJ4Perturbation).Propagate()
        modify(keplerian3, 6500, 0, group[i][0], group[i][1], group[i][2], group[i][4])
        sat3.Propagator.QueryInterface(
            STKObjects.IAgVePropagatorJ4Perturbation).InitialState.Representation.Assign(keplerian3)
        sat3.Propagator.QueryInterface(
            STKObjects.IAgVePropagatorJ4Perturbation).Propagate()

        # 计算
        chain1.ComputeAccess()
        chain2.ComputeAccess()
        chain3.ComputeAccess()
        chainResults1 = chainTemp1.DataProviders.GetDataPrvIntervalFromPath(
            "Complete Access").Exec(sc2.StartTime, sc2.StopTime)
        chainResults2 = chainTemp2.DataProviders.GetDataPrvIntervalFromPath(
            "Complete Access").Exec(sc2.StartTime, sc2.StopTime)
        chainResults3 = chainTemp3.DataProviders.GetDataPrvIntervalFromPath(
            "Complete Access").Exec(sc2.StartTime, sc2.StopTime)
        if chainResults1.DataSets.Count != 0:
            coverage1 = sum(chainResults1.DataSets.GetDataSetByName(
                "Duration").GetValues()) / totalTime * 100
        else:
            coverage1 = 0
        if chainResults2.DataSets.Count != 0:
            coverage2 = sum(chainResults2.DataSets.GetDataSetByName(
                "Duration").GetValues()) / totalTime * 100
        else:
            coverage2 = 0
        if chainResults3.DataSets.Count != 0:
            coverage3 = sum(chainResults3.DataSets.GetDataSetByName(
                "Duration").GetValues()) / totalTime * 100
        else:
            coverage3 = 0

        # 得分
        scores[i] = coverage1 + coverage2 + coverage3
    return scores

def cal_once(group):
    # 调整
    modify(keplerian1, 6500, 0, group[0], group[1], group[2], 0)
    sat1.Propagator.QueryInterface(
        STKObjects.IAgVePropagatorJ4Perturbation).InitialState.Representation.Assign(keplerian1)
    sat1.Propagator.QueryInterface(
        STKObjects.IAgVePropagatorJ4Perturbation).Propagate()
    modify(keplerian2, 6500, 0, group[0], group[1], group[2], group[3])
    sat2.Propagator.QueryInterface(
        STKObjects.IAgVePropagatorJ4Perturbation).InitialState.Representation.Assign(keplerian2)
    sat2.Propagator.QueryInterface(
        STKObjects.IAgVePropagatorJ4Perturbation).Propagate()
    modify(keplerian3, 6500, 0, group[0], group[1], group[2], group[4])
    sat3.Propagator.QueryInterface(
        STKObjects.IAgVePropagatorJ4Perturbation).InitialState.Representation.Assign(keplerian3)
    sat3.Propagator.QueryInterface(
        STKObjects.IAgVePropagatorJ4Perturbation).Propagate()

    # 计算
    chain1.ComputeAccess()
    chain2.ComputeAccess()
    chain3.ComputeAccess()
    chainResults1 = chainTemp1.DataProviders.GetDataPrvIntervalFromPath(
        "Complete Access").Exec(sc2.StartTime, sc2.StopTime)
    chainResults2 = chainTemp2.DataProviders.GetDataPrvIntervalFromPath(
        "Complete Access").Exec(sc2.StartTime, sc2.StopTime)
    chainResults3 = chainTemp3.DataProviders.GetDataPrvIntervalFromPath(
        "Complete Access").Exec(sc2.StartTime, sc2.StopTime)
    if chainResults1.DataSets.Count != 0:
        coverage1 = sum(chainResults1.DataSets.GetDataSetByName(
            "Duration").GetValues()) / totalTime * 100
    else:
        coverage1 = 0
    if chainResults2.DataSets.Count != 0:
        coverage2 = sum(chainResults2.DataSets.GetDataSetByName(
            "Duration").GetValues()) / totalTime * 100
    else:
        coverage2 = 0
    if chainResults3.DataSets.Count != 0:
        coverage3 = sum(chainResults3.DataSets.GetDataSetByName(
            "Duration").GetValues()) / totalTime * 100
    else:
        coverage3 = 0

    # 得分
    score = coverage1 + coverage2 + coverage3
    return score


def init():
    print("---------------- begin GA init ----------------")
    # input inited group
    group = [[50.72839028036404, 90, 359.9224751621648, 138.31224912282173, 220.2466354493924], [39.875166533371264, 90, 325.89860246183093, 138.31224912282173, 220.2466354493924], [46.37977854416812, 90, 272.6793625493216, 149.06120979834316, 207.83607005394632], [47.59567157134627, 90, 190.63917047273148, 185.4581842397622, 220.2466354493924], [51.66274325408448, 90, 74.1742237330616, 138.31224912282173, 168.6433793263243], [39.95949537968622, 90, 325.89860246183093, 138.31224912282173, 220.2466354493924], [39.3489581926417, 90, 141.7532930288935, 138.31224912282173, 207.83607005394632], [48.073717191446065, 90, 109.37666018360338, 138.31224912282173, 220.2466354493924], [41.53119200792531, 90, 109.37666018360338, 138.31224912282173, 220.2466354493924], [50.48049561733598, 90, 317.2865499449926, 138.31224912282173, 220.2466354493924], [51.605126196148525, 90, 75.8945325257913, 138.31224912282173, 207.83607005394632], [41.25700739729837, 90, 14.71588636008045, 185.4581842397622, 220.2466354493924], [47.243445150903696, 90, 352.14000135790496, 138.31224912282173, 220.2466354493924], [44.96619292871524, 90, 169.03403714135493, 138.31224912282173, 207.83607005394632], [48.29530600971388, 90, 178.9938184455392, 138.31224912282173, 207.83607005394632], [45.26281355546354, 270, 141.7532930288935, 138.31224912282173, 207.83607005394632], [50.87082296857393, 90, 223.66394429268198, 149.06120979834316, 207.83607005394632], [45.26281355546354, 90, 14.71588636008045, 185.4581842397622, 207.83607005394632], [41.55890967533929, 90, 9.571224309615275, 177.1556241327515, 220.2466354493924], [40.3269303034353, 90, 256.9691827236982, 138.31224912282173, 220.2466354493924], [40.564011109396475, 90, 248.83548469643927, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [47.878509272300775, 270, 208.28784117837603, 138.31224912282173, 220.2466354493924], [41.38868629657357, 90, 30.38598493168235, 185.4581842397622, 207.83607005394632], [40.7225549045425, 90, 48.28038670944805, 138.31224912282173, 220.2466354493924], [39.503772230767, 90, 178.61746189359863, 138.31224912282173, 207.83607005394632], [40.3269303034353, 90, 256.9691827236982, 138.31224912282173, 220.2466354493924], [46.848864267051376, 90, 30.150939221833024, 138.31224912282173, 168.6433793263243], [42.656389806078124, 90, 256.83023125310723, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 14.71588636008045, 185.4581842397622, 220.2466354493924], [40.16123765734991, 270, 314.79525755502385, 138.31224912282173, 220.2466354493924], [41.55890967533929, 90, 136.70399692506516, 149.06120979834316, 220.2466354493924], [47.59567157134627, 90, 190.63917047273148, 185.4581842397622, 220.2466354493924], [43.140438589371435, 90, 291.00946240778114, 138.31224912282173, 220.2466354493924], [41.57611951651307, 90, 256.9691827236982, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 84.7132745323866, 149.06120979834316, 220.2466354493924], [41.391144384753865, 270, 38.308047188798476, 138.31224912282173, 207.83607005394632], [39.773877926725525, 270, 60.13358615602102, 138.31224912282173, 220.2466354493924], [51.852268565176765, 90, 89.18034498237489, 138.31224912282173, 173.7530751333942], [43.761510110811884, 90, 270.6136265017543, 138.31224912282173, 207.83607005394632], [44.50344574430662, 90, 120.44351271745137, 138.31224912282173, 220.2466354493924], [47.26151311011814, 90, 126.07312867369377, 138.31224912282173, 220.2466354493924], [42.99416516444344, 90, 317.55027797677104, 138.31224912282173, 173.7530751333942], [39.773877926725525, 90, 203.607796848344, 138.31224912282173, 220.2466354493924], [40.7225549045425, 90, 280.54317392895234, 138.31224912282173, 220.2466354493924], [40.564011109396475, 270, 317.5312587218282, 138.31224912282173, 207.83607005394632], [42.51025446107936, 90, 359.9224751621648, 138.31224912282173, 220.2466354493924], [42.51025446107936, 90, 246.11046163930618, 138.31224912282173, 207.83607005394632], [47.50174042513552, 90, 226.71621208128028, 138.31224912282173, 220.2466354493924], [41.3174541110529, 90, 221.85918076381532, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 175.61519993306382, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 175.61519993306382, 138.31224912282173, 220.2466354493924], [42.17728898758244, 90, 200.45608813037416, 138.31224912282173, 220.2466354493924], [42.51025446107936, 90, 112.6223699986464, 138.31224912282173, 207.83607005394632], [39.56571024979391, 90, 282.0688868142486, 138.31224912282173, 207.83607005394632], [39.503772230767, 90, 209.22649560836288, 138.31224912282173, 220.2466354493924], [48.78055110945897, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 359.9224751621648, 138.31224912282173, 220.2466354493924], [43.98988457719641, 90, 76.0365543609157, 149.06120979834316, 207.83607005394632], [45.26281355546354, 90, 312.6943229362799, 138.31224912282173, 220.2466354493924], [40.564011109396475, 270, 270.6136265017543, 138.31224912282173, 207.83607005394632], [48.78055110945897, 90, 71.42752452578375, 138.31224912282173, 220.2466354493924], [39.875166533371264, 90, 339.87548238045, 138.31224912282173, 207.83607005394632], [41.391144384753865, 270, 141.7532930288935, 138.31224912282173, 220.2466354493924], [42.99416516444344, 90, 18.413370083326907, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 203.607796848344, 138.31224912282173, 220.2466354493924], [40.3269303034353, 90, 116.18671337536766, 138.31224912282173, 220.2466354493924], [42.559082549951675, 90, 256.9691827236982, 138.31224912282173, 207.83607005394632], [41.55890967533929, 90, 205.84418390079185, 185.4581842397622, 220.2466354493924], [47.00676291990361, 90, 246.11046163930618, 138.31224912282173, 282.4565651407049], [51.44608870219426, 90, 75.8945325257913, 149.06120979834316, 168.6433793263243], [43.78290826917636, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [41.132804534065535, 90, 336.07392465745767, 138.31224912282173, 220.2466354493924], [41.53119200792531, 90, 109.37666018360338, 138.31224912282173, 207.83607005394632], [39.773877926725525, 270, 79.97112379820645, 138.31224912282173, 220.2466354493924], [39.36066394682889, 90, 153.5871767950164, 138.31224912282173, 220.2466354493924], [51.49370127836769, 90, 256.83023125310723, 138.31224912282173, 220.2466354493924], [49.65458903831359, 90, 271.0458186190343, 138.31224912282173, 220.2466354493924], [47.50174042513552, 90, 334.18458190229063, 149.06120979834316, 207.83607005394632], [48.78055110945897, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [47.50174042513552, 90, 223.66394429268198, 149.06120979834316, 207.83607005394632], [45.26281355546354, 90, 200.45608813037416, 138.31224912282173, 173.7530751333942], [43.98899862123025, 90, 60.13358615602102, 138.31224912282173, 220.2466354493924], [41.391144384753865, 90, 116.18671337536766, 138.31224912282173, 207.83607005394632], [51.625263715261966, 90, 75.8945325257913, 138.31224912282173, 168.6433793263243], [42.51025446107936, 270, 224.00396668706153, 149.06120979834316, 168.6433793263243], [39.773877926725525, 90, 256.83023125310723, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 112.6223699986464, 138.31224912282173, 220.2466354493924], [41.391144384753865, 90, 359.9224751621648, 138.31224912282173, 207.83607005394632], [48.91961063836496, 270, 306.7727133617977, 138.31224912282173, 220.2466354493924], [42.568164556715175, 90, 290.5626421992111, 149.06120979834316, 220.2466354493924], [44.20118596602477, 90, 270.6136265017543, 232.23806646878214, 220.2466354493924], [43.12361979895188, 270, 278.3376223195685, 138.31224912282173, 220.2466354493924], [48.37267695289076, 270, 17.118562900674064, 138.31224912282173, 173.7530751333942], [40.564011109396475, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 30.150939221833024, 138.31224912282173, 220.2466354493924], [46.45726241748536, 90, 121.02704946612857, 149.06120979834316, 220.2466354493924], [42.51025446107936, 90, 290.5626421992111, 149.06120979834316, 220.2466354493924], [41.55890967533929, 90, 346.66704728268377, 138.31224912282173, 168.6433793263243], [42.65534208062574, 90, 60.88633189903098, 138.31224912282173, 220.2466354493924], [39.773877926725525, 270, 17.118562900674064, 138.31224912282173, 207.83607005394632], [46.62923569049515, 90, 178.9938184455392, 138.31224912282173, 220.2466354493924], [40.16123765734991, 270, 351.23054315098483, 185.4581842397622, 220.2466354493924], [39.773877926725525, 90, 14.71588636008045, 138.31224912282173, 207.83607005394632], [40.564011109396475, 90, 30.150939221833024, 138.31224912282173, 220.2466354493924], [41.55890967533929, 90, 60.88633189903098, 138.31224912282173, 220.2466354493924], [40.48405208472704, 90, 210.23788672696173, 138.31224912282173, 207.83607005394632], [40.269777185339315, 90, 102.61741223786956, 138.31224912282173, 220.2466354493924], [48.35951770878628, 90, 102.61741223786956, 138.31224912282173, 220.2466354493924], [41.55890967533929, 270, 21.22402872087635, 138.31224912282173, 220.2466354493924], [39.3489581926417, 90, 132.63784849447995, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 99.59840102226568, 185.4581842397622, 282.4565651407049], [46.36596737936142, 90, 238.31719671561785, 185.4581842397622, 220.2466354493924], [46.192953871367045, 90, 178.9938184455392, 138.31224912282173, 207.83607005394632], [41.132804534065535, 90, 270.6136265017543, 138.31224912282173, 207.83607005394632], [45.450489567118744, 90, 4.148178567767609, 185.4581842397622, 207.83607005394632], [42.51025446107936, 90, 325.42671459809895, 138.31224912282173, 220.2466354493924], [40.564011109396475, 270, 145.23199541241837, 138.31224912282173, 207.83607005394632], [39.773877926725525, 270, 325.89860246183093, 138.31224912282173, 220.2466354493924], [39.875166533371264, 90, 187.11494558078422, 138.31224912282173, 220.2466354493924], [41.53119200792531, 90, 327.4961204589984, 138.31224912282173, 220.2466354493924], [47.50174042513552, 270, 116.04949270974954, 149.06120979834316, 207.83607005394632], [47.50174042513552, 90, 334.18458190229063, 149.06120979834316, 207.83607005394632], [39.773877926725525, 90, 100.37501749051202, 138.31224912282173, 220.2466354493924], [39.56571024979391, 90, 27.49141450503366, 232.23806646878214, 220.2466354493924], [39.773877926725525, 90, 248.83548469643927, 138.31224912282173, 220.2466354493924], [48.31395111951318, 90, 0.07582883514756666, 138.31224912282173, 207.83607005394632], [41.53119200792531, 90, 41.59842283776938, 138.31224912282173, 207.83607005394632], [39.36066394682889, 90, 153.5871767950164, 138.31224912282173, 220.2466354493924], [50.08350298927762, 90, 218.81058478876318, 149.06120979834316, 220.2466354493924], [39.875166533371264, 90, 116.18671337536766, 138.31224912282173, 220.2466354493924], [42.269014067975846, 90, 347.30227092770446, 138.31224912282173, 220.2466354493924], [47.55252336890159, 270, 99.59840102226568, 138.31224912282173, 207.83607005394632], [40.7225549045425, 90, 256.83023125310723, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 359.9224751621648, 138.31224912282173, 220.2466354493924], [41.57611951651307, 90, 141.7532930288935, 138.31224912282173, 207.83607005394632], [39.773877926725525, 270, 141.7532930288935, 138.31224912282173, 220.2466354493924], [43.78290826917636, 90, 235.2149251650419, 149.06120979834316, 220.2466354493924], [40.809173697536515, 90, 189.5771791823881, 138.31224912282173, 207.83607005394632], [40.06910571617579, 90, 351.23054315098483, 138.31224912282173, 207.83607005394632], [47.55252336890159, 90, 99.59840102226568, 138.31224912282173, 220.2466354493924], [39.773877926725525, 270, 325.42671459809895, 138.31224912282173, 207.83607005394632], [41.55890967533929, 90, 290.5626421992111, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 225.36859768274064, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 100.37501749051202, 138.31224912282173, 220.2466354493924], [39.503772230767, 90, 178.61746189359863, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 187.11494558078422, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 100.37501749051202, 138.31224912282173, 220.2466354493924], [41.132804534065535, 90, 336.07392465745767, 138.31224912282173, 220.2466354493924], [44.66004862110185, 90, 339.87548238045, 138.31224912282173, 173.7530751333942], [46.6109010682648, 270, 141.7532930288935, 138.31224912282173, 207.83607005394632], [51.79322777939016, 90, 30.150939221833024, 149.06120979834316, 220.2466354493924], [44.50344574430662, 90, 270.6136265017543, 138.31224912282173, 173.7530751333942], [43.94578627325127, 270, 212.38113058787997, 138.31224912282173, 207.83607005394632], [39.3489581926417, 90, 132.63784849447995, 138.31224912282173, 220.2466354493924], [41.391144384753865, 90, 60.13358615602102, 138.31224912282173, 207.83607005394632], [50.49063235704864, 270, 20.087929923010854, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 190.26655979131957, 149.06120979834316, 207.83607005394632], [46.83531552370113, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [47.55252336890159, 90, 99.59840102226568, 138.31224912282173, 207.83607005394632], [39.95949537968622, 270, 105.93326717545746, 138.31224912282173, 220.2466354493924], [51.66274325408448, 90, 74.1742237330616, 138.31224912282173, 168.6433793263243], [41.3174541110529, 90, 116.18671337536766, 138.31224912282173, 220.2466354493924], [47.843648781003246, 90, 266.22036274526755, 138.31224912282173, 207.83607005394632], [40.89793869390082, 90, 223.66394429268198, 149.06120979834316, 207.83607005394632], [44.50344574430662, 90, 324.2083622925763, 138.31224912282173, 220.2466354493924], [45.15038953365346, 90, 105.93326717545746, 138.31224912282173, 220.2466354493924], [40.89793869390082, 90, 266.22036274526755, 149.06120979834316, 207.83607005394632], [46.83531552370113, 90, 270.6136265017543, 138.31224912282173, 207.83607005394632], [41.3174541110529, 90, 116.18671337536766, 138.31224912282173, 207.83607005394632], [43.94578627325127, 90, 212.38113058787997, 138.31224912282173, 220.2466354493924], [40.991485258688215, 90, 291.00946240778114, 138.31224912282173, 220.2466354493924], [42.51025446107936, 90, 75.8945325257913, 138.31224912282173, 207.83607005394632], [48.78055110945897, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [39.50308113457197, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [43.15008233051187, 90, 290.5626421992111, 149.06120979834316, 207.83607005394632], [47.878509272300775, 90, 102.81301711586865, 138.31224912282173, 220.2466354493924], [39.50308113457197, 270, 325.42671459809895, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 248.83548469643927, 138.31224912282173, 207.83607005394632], [39.33280051981966, 270, 153.5871767950164, 138.31224912282173, 220.2466354493924], [39.875166533371264, 90, 116.18671337536766, 149.06120979834316, 207.83607005394632], [39.50308113457197, 90, 231.83718434751407, 138.31224912282173, 207.83607005394632], [51.852268565176765, 90, 223.66394429268198, 149.06120979834316, 220.2466354493924], [41.3174541110529, 90, 116.18671337536766, 138.31224912282173, 220.2466354493924], [40.7225549045425, 90, 48.28038670944805, 138.31224912282173, 220.2466354493924], [42.17728898758244, 90, 200.45608813037416, 138.31224912282173, 220.2466354493924], [47.00676291990361, 270, 178.9938184455392, 138.31224912282173, 207.83607005394632], [39.56571024979391, 270, 291.5824091087604, 149.06120979834316, 220.2466354493924], [39.503772230767, 90, 209.22649560836288, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 48.28038670944805, 138.31224912282173, 220.2466354493924], [40.7225549045425, 90, 29.899735310953638, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 190.26655979131957, 138.31224912282173, 220.2466354493924], [52.024320093827015, 90, 66.40125102601897, 138.31224912282173, 220.2466354493924], [40.3269303034353, 270, 20.087929923010854, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 14.71588636008045, 185.4581842397622, 207.83607005394632], [39.3489581926417, 90, 132.63784849447995, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 359.9224751621648, 138.31224912282173, 220.2466354493924], [45.26281355546354, 90, 116.18671337536766, 138.31224912282173, 220.2466354493924], [43.98899862123025, 270, 231.83718434751407, 138.31224912282173, 207.83607005394632], [40.7225549045425, 90, 48.28038670944805, 138.31224912282173, 220.2466354493924], [45.26281355546354, 90, 265.0380144922108, 149.06120979834316, 220.2466354493924], [39.773877926725525, 90, 256.9691827236982, 138.31224912282173, 207.83607005394632], [40.809173697536515, 90, 246.11046163930618, 138.31224912282173, 207.83607005394632], [50.08350298927762, 90, 218.81058478876318, 149.06120979834316, 220.2466354493924], [47.320815854567904, 90, 246.11046163930618, 138.31224912282173, 207.83607005394632], [42.51025446107936, 90, 319.636770161101, 138.31224912282173, 207.83607005394632], [46.62923569049515, 90, 320.1996834951887, 149.06120979834316, 207.83607005394632], [43.98899862123025, 90, 116.18671337536766, 138.31224912282173, 220.2466354493924], [47.00676291990361, 90, 320.1996834951887, 149.06120979834316, 207.83607005394632], [41.48922063673473, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [41.53119200792531, 90, 58.89915488903001, 138.31224912282173, 220.2466354493924], [47.74670035812095, 90, 172.3334539184548, 138.31224912282173, 207.83607005394632], [40.00409159735413, 90, 210.23788672696173, 138.31224912282173, 220.2466354493924], [40.3269303034353, 90, 178.61746189359863, 185.4581842397622, 220.2466354493924], [39.773877926725525, 90, 270.6136265017543, 149.06120979834316, 207.83607005394632], [41.53119200792531, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 317.55027797677104, 149.06120979834316, 207.83607005394632], [43.15008233051187, 90, 210.23788672696173, 149.06120979834316, 220.2466354493924], [40.269777185339315, 90, 290.5626421992111, 138.31224912282173, 207.83607005394632], [39.95949537968622, 90, 105.93326717545746, 138.31224912282173, 220.2466354493924], [42.514867725390886, 90, 109.37666018360338, 138.31224912282173, 220.2466354493924], [44.96619292871524, 90, 212.38113058787997, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 359.9224751621648, 138.31224912282173, 220.2466354493924], [42.92799003583317, 90, 178.9938184455392, 138.31224912282173, 207.83607005394632], [42.92799003583317, 90, 178.9938184455392, 138.31224912282173, 207.83607005394632], [47.50174042513552, 90, 9.571224309615275, 177.1556241327515, 207.83607005394632], [40.98924512111199, 90, 30.150939221833024, 138.31224912282173, 220.2466354493924], [41.55890967533929, 90, 14.71588636008045, 185.4581842397622, 220.2466354493924], [41.3174541110529, 90, 221.85918076381532, 138.31224912282173, 220.2466354493924], [39.8344330012782, 90, 30.150939221833024, 138.31224912282173, 220.2466354493924], [46.45726241748536, 90, 290.5626421992111, 149.06120979834316, 220.2466354493924], [39.875166533371264, 90, 200.45608813037416, 138.31224912282173, 207.83607005394632], [40.3269303034353, 90, 178.61746189359863, 185.4581842397622, 220.2466354493924], [46.75875087820366, 90, 187.11494558078422, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 153.5871767950164, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 353.26005720273423, 138.31224912282173, 220.2466354493924], [41.391144384753865, 90, 339.87548238045, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 55.18382745013285, 185.4581842397622, 220.2466354493924], [45.095561666686955, 90, 20.087929923010854, 138.31224912282173, 220.2466354493924], [50.078130290477134, 90, 200.45608813037416, 138.31224912282173, 220.2466354493924], [45.26281355546354, 90, 200.45608813037416, 138.31224912282173, 220.2466354493924], [40.41682762054029, 90, 238.31719671561785, 138.31224912282173, 220.2466354493924], [41.42188334188227, 90, 141.7532930288935, 138.31224912282173, 207.83607005394632], [45.50345792871883, 90, 100.37501749051202, 138.31224912282173, 220.2466354493924], [50.54591435684914, 90, 57.25757424727957, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 256.9691827236982, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 175.61519993306382, 138.31224912282173, 220.2466354493924], [47.00676291990361, 90, 99.59840102226568, 185.4581842397622, 282.4565651407049], [39.773877926725525, 270, 320.1996834951887, 149.06120979834316, 207.83607005394632], [40.7225549045425, 90, 325.89860246183093, 138.31224912282173, 207.83607005394632], [51.852268565176765, 270, 148.18162895123632, 138.31224912282173, 220.2466354493924], [47.50174042513552, 90, 231.83718434751407, 149.06120979834316, 207.83607005394632], [48.80084734728591, 270, 116.04949270974954, 138.31224912282173, 207.83607005394632], [45.26281355546354, 90, 109.37666018360338, 138.31224912282173, 173.7530751333942], [39.50308113457197, 90, 325.89860246183093, 138.31224912282173, 220.2466354493924], [43.78290826917636, 90, 105.93326717545746, 138.31224912282173, 220.2466354493924], [48.05658475551709, 90, 268.45508944613954, 149.06120979834316, 220.2466354493924], [41.04701442730645, 90, 89.18034498237489, 138.31224912282173, 173.7530751333942], [44.50344574430662, 90, 307.1274732901318, 138.31224912282173, 220.2466354493924], [40.3269303034353, 90, 132.63784849447995, 138.31224912282173, 220.2466354493924], [45.95457262619777, 270, 256.9691827236982, 138.31224912282173, 220.2466354493924], [42.64523786948591, 90, 353.26005720273423, 138.31224912282173, 220.2466354493924], [48.78055110945897, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [42.51025446107936, 90, 319.636770161101, 138.31224912282173, 220.2466354493924], [41.3174541110529, 90, 272.6793625493216, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 256.83023125310723, 138.31224912282173, 220.2466354493924], [49.65458903831359, 90, 280.54317392895234, 138.31224912282173, 220.2466354493924], [45.26281355546354, 90, 312.6943229362799, 149.06120979834316, 207.83607005394632], [40.7225549045425, 90, 127.37401806212884, 138.31224912282173, 220.2466354493924], [39.503772230767, 90, 215.03690508543806, 138.31224912282173, 220.2466354493924], [46.7535663765948, 90, 66.40125102601897, 138.31224912282173, 220.2466354493924], [39.503772230767, 270, 272.6793625493216, 138.31224912282173, 220.2466354493924], [41.3174541110529, 90, 291.5824091087604, 149.06120979834316, 220.2466354493924], [39.773877926725525, 90, 325.89860246183093, 138.31224912282173, 220.2466354493924], [46.848864267051376, 90, 30.150939221833024, 138.31224912282173, 168.6433793263243], [39.773877926725525, 90, 188.4770345165803, 149.06120979834316, 220.2466354493924], [46.30257572107774, 90, 165.67413918841845, 138.31224912282173, 207.83607005394632], [42.65534208062574, 90, 155.59155320484882, 138.31224912282173, 220.2466354493924], [42.92799003583317, 90, 224.88511388609504, 138.31224912282173, 168.6433793263243], [44.20118596602477, 90, 344.9978792339529, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 320.1996834951887, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 317.55027797677104, 138.31224912282173, 173.7530751333942], [44.50344574430662, 90, 112.87880453404195, 138.31224912282173, 220.2466354493924], [45.26281355546354, 90, 231.83718434751407, 138.31224912282173, 207.83607005394632], [41.55890967533929, 90, 109.37666018360338, 138.31224912282173, 220.2466354493924], [47.00676291990361, 270, 320.1996834951887, 149.06120979834316, 220.2466354493924], [48.56365801540645, 270, 105.93326717545746, 138.31224912282173, 207.83607005394632], [48.0187244914551, 90, 197.3365570465081, 138.31224912282173, 220.2466354493924], [39.773877926725525, 270, 178.9938184455392, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 238.31719671561785, 138.31224912282173, 220.2466354493924], [40.41682762054029, 90, 188.4770345165803, 138.31224912282173, 220.2466354493924], [39.95949537968622, 90, 325.89860246183093, 138.31224912282173, 220.2466354493924], [40.809173697536515, 90, 246.11046163930618, 138.31224912282173, 207.83607005394632], [46.45726241748536, 90, 109.37666018360338, 138.31224912282173, 220.2466354493924], [41.55890967533929, 90, 290.5626421992111, 149.06120979834316, 220.2466354493924], [39.773877926725525, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [41.3174541110529, 90, 209.22649560836288, 138.31224912282173, 220.2466354493924], [39.50308113457197, 90, 339.87548238045, 138.31224912282173, 207.83607005394632], [39.8423429710127, 90, 231.83718434751407, 138.31224912282173, 207.83607005394632], [51.62294472991078, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [41.45265215492919, 90, 178.9938184455392, 138.31224912282173, 207.83607005394632], [43.72769103697349, 90, 30.150939221833024, 138.31224912282173, 220.2466354493924], [46.739360220224526, 90, 353.26005720273423, 138.31224912282173, 220.2466354493924], [40.3269303034353, 90, 61.5559151568723, 138.31224912282173, 207.83607005394632], [48.78055110945897, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [39.95949537968622, 90, 325.89860246183093, 138.31224912282173, 220.2466354493924], [40.89793869390082, 90, 266.22036274526755, 138.31224912282173, 207.83607005394632], [40.3269303034353, 270, 155.59155320484882, 138.31224912282173, 207.83607005394632], [40.83643550539909, 90, 99.59840102226568, 185.4581842397622, 282.4565651407049], [42.92799003583317, 90, 351.23054315098483, 138.31224912282173, 207.83607005394632], [40.00409159735413, 90, 178.9938184455392, 138.31224912282173, 207.83607005394632], [42.92799003583317, 90, 178.9938184455392, 138.31224912282173, 220.2466354493924], [50.193861145849354, 90, 359.9224751621648, 138.31224912282173, 207.83607005394632], [41.57611951651307, 90, 314.79525755502385, 138.31224912282173, 220.2466354493924], [45.84402836100052, 90, 188.4770345165803, 149.06120979834316, 220.2466354493924], [52.16436084486149, 90, 153.5871767950164, 138.31224912282173, 207.83607005394632], [39.42654363228699, 90, 271.0458186190343, 138.31224912282173, 207.83607005394632], [51.022015371531936, 90, 223.66394429268198, 149.06120979834316, 207.83607005394632], [45.26281355546354, 270, 291.00946240778114, 138.31224912282173, 207.83607005394632], [41.55890967533929, 90, 148.18162895123632, 138.31224912282173, 220.2466354493924], [39.503772230767, 270, 291.5824091087604, 149.06120979834316, 220.2466354493924], [40.3269303034353, 270, 178.9938184455392, 138.31224912282173, 220.2466354493924], [47.50174042513552, 270, 244.22429137828993, 138.31224912282173, 220.2466354493924], [41.53119200792531, 90, 32.35026604650173, 138.31224912282173, 220.2466354493924], [41.53119200792531, 90, 229.58592588045818, 149.06120979834316, 207.83607005394632], [42.656389806078124, 90, 256.83023125310723, 138.31224912282173, 220.2466354493924], [41.558234555986594, 90, 353.26005720273423, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 256.83023125310723, 138.31224912282173, 220.2466354493924], [45.76906947959843, 90, 178.9938184455392, 138.31224912282173, 207.83607005394632], [42.559082549951675, 90, 221.85918076381532, 138.31224912282173, 207.83607005394632], [48.13867211202922, 90, 113.26363809678321, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 248.83548469643927, 138.31224912282173, 220.2466354493924], [42.17728898758244, 90, 200.45608813037416, 138.31224912282173, 220.2466354493924], [41.3174541110529, 90, 209.22649560836288, 138.31224912282173, 220.2466354493924], [44.50344574430662, 90, 91.92839369677222, 185.4581842397622, 220.2466354493924], [42.269014067975846, 90, 347.30227092770446, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 30.150939221833024, 138.31224912282173, 207.83607005394632], [44.20118596602477, 90, 56.53701696603018, 138.31224912282173, 207.83607005394632], [43.52949705788846, 90, 325.89860246183093, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 317.55027797677104, 138.31224912282173, 207.83607005394632], [45.55309195993699, 90, 270.6136265017543, 149.06120979834316, 173.7530751333942], [39.50308113457197, 90, 178.61746189359863, 138.31224912282173, 220.2466354493924], [39.773877926725525, 270, 359.9224751621648, 138.31224912282173, 220.2466354493924], [47.680277183567256, 90, 178.9938184455392, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 220.45086887420948, 138.31224912282173, 220.2466354493924], [40.36501229190852, 90, 40.735688449690535, 138.31224912282173, 207.83607005394632], [40.269777185339315, 90, 246.11046163930618, 138.31224912282173, 282.4565651407049], [40.7225549045425, 90, 127.37401806212884, 138.31224912282173, 220.2466354493924], [41.53119200792531, 270, 317.55027797677104, 138.31224912282173, 220.2466354493924], [40.91104522610362, 90, 147.87722914661654, 138.31224912282173, 207.83607005394632], [47.00676291990361, 270, 75.8945325257913, 138.31224912282173, 207.83607005394632], [51.66272829158663, 90, 55.18382745013285, 185.4581842397622, 220.2466354493924], [39.773877926725525, 90, 153.5871767950164, 138.31224912282173, 220.2466354493924], [40.564011109396475, 90, 301.37922625310506, 149.06120979834316, 207.83607005394632], [39.3489581926417, 90, 141.7532930288935, 138.31224912282173, 207.83607005394632], [50.34709531813741, 90, 339.87548238045, 138.31224912282173, 207.83607005394632], [42.75331926650986, 90, 347.30227092770446, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [42.559082549951675, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [48.65074649740977, 90, 270.6136265017543, 138.31224912282173, 173.7530751333942], [45.26281355546354, 90, 320.1996834951887, 149.06120979834316, 207.83607005394632], [41.48922063673473, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [45.26281355546354, 90, 132.63784849447995, 138.31224912282173, 220.2466354493924], [39.773877926725525, 270, 18.413370083326907, 138.31224912282173, 220.2466354493924], [39.773877926725525, 270, 253.29486006236323, 149.06120979834316, 207.83607005394632], [46.36596737936142, 90, 301.69575148512627, 138.31224912282173, 220.2466354493924], [39.773877926725525, 270, 359.9224751621648, 185.4581842397622, 220.2466354493924], [45.26281355546354, 90, 148.18162895123632, 138.31224912282173, 220.2466354493924], [50.078130290477134, 90, 200.45608813037416, 138.31224912282173, 220.2466354493924], [40.7225549045425, 270, 129.82109359089375, 138.31224912282173, 220.2466354493924], [40.56172378081266, 270, 220.62384635128473, 138.31224912282173, 207.83607005394632], [39.50308113457197, 90, 359.9224751621648, 138.31224912282173, 207.83607005394632], [48.05595860374863, 90, 301.31313478734654, 138.31224912282173, 207.83607005394632], [52.16436084486149, 90, 153.5871767950164, 138.31224912282173, 220.2466354493924], [39.50308113457197, 270, 294.9019593804165, 138.31224912282173, 207.83607005394632], [39.773877926725525, 270, 105.87462633036161, 185.4581842397622, 220.2466354493924], [43.15008233051187, 90, 220.45086887420948, 138.31224912282173, 207.83607005394632], [41.3174541110529, 90, 272.6793625493216, 138.31224912282173, 207.83607005394632], [42.559082549951675, 90, 116.18671337536766, 138.31224912282173, 220.2466354493924], [51.80631250057905, 270, 141.7532930288935, 138.31224912282173, 207.83607005394632], [39.42654363228699, 90, 178.61746189359863, 138.31224912282173, 220.2466354493924], [40.7225549045425, 270, 280.54317392895234, 138.31224912282173, 220.2466354493924], [45.99139739872516, 90, 74.1742237330616, 138.31224912282173, 168.6433793263243], [42.51025446107936, 90, 14.71588636008045, 138.31224912282173, 220.2466354493924], [50.48049561733598, 90, 317.2865499449926, 185.4581842397622, 207.83607005394632], [45.450489567118744, 90, 4.148178567767609, 185.4581842397622, 207.83607005394632], [43.15008233051187, 90, 290.5626421992111, 149.06120979834316, 220.2466354493924], [41.391144384753865, 90, 42.422174533679645, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 359.9224751621648, 138.31224912282173, 207.83607005394632], [40.3269303034353, 90, 220.62384635128473, 138.31224912282173, 207.83607005394632], [40.7225549045425, 90, 25.654015355228527, 138.31224912282173, 207.83607005394632], [45.55309195993699, 90, 317.55027797677104, 138.31224912282173, 173.7530751333942], [47.50174042513552, 90, 30.150939221833024, 138.31224912282173, 207.83607005394632], [47.18761859033687, 90, 270.6136265017543, 138.31224912282173, 173.7530751333942], [42.87172980754587, 90, 14.71588636008045, 138.31224912282173, 220.2466354493924], [48.93380754415436, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 242.0968121806977, 138.31224912282173, 220.2466354493924], [41.57611951651307, 90, 141.7532930288935, 138.31224912282173, 207.83607005394632], [40.3269303034353, 90, 20.087929923010854, 138.31224912282173, 207.83607005394632], [45.26281355546354, 90, 223.66394429268198, 149.06120979834316, 207.83607005394632], [46.250326641026874, 90, 145.91529239574155, 138.31224912282173, 207.83607005394632], [48.29530600971388, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [48.45510205903152, 90, 172.7179040106346, 138.31224912282173, 220.2466354493924], [42.6825021867559, 90, 14.71588636008045, 138.31224912282173, 207.83607005394632], [41.38868629657357, 90, 30.38598493168235, 185.4581842397622, 207.83607005394632], [42.87172980754587, 90, 14.71588636008045, 138.31224912282173, 220.2466354493924], [39.50308113457197, 90, 248.83548469643927, 138.31224912282173, 207.83607005394632], [42.514867725390886, 90, 200.45608813037416, 138.31224912282173, 220.2466354493924], [45.26281355546354, 90, 109.37666018360338, 138.31224912282173, 220.2466354493924], [44.20118596602477, 90, 187.11494558078422, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 325.89860246183093, 138.31224912282173, 220.2466354493924], [42.51025446107936, 270, 359.9224751621648, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 116.58584342547053, 138.31224912282173, 220.2466354493924], [40.41682762054029, 90, 238.31719671561785, 138.31224912282173, 220.2466354493924], [42.17728898758244, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [39.50308113457197, 90, 248.83548469643927, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 175.61519993306382, 138.31224912282173, 220.2466354493924], [48.50957723632026, 90, 347.30227092770446, 138.31224912282173, 220.2466354493924], [45.26281355546354, 90, 116.18671337536766, 138.31224912282173, 207.83607005394632], [40.28331947553764, 90, 167.31446944929252, 138.31224912282173, 220.2466354493924], [46.7535663765948, 90, 66.40125102601897, 138.31224912282173, 220.2466354493924], [41.45265215492919, 90, 141.7532930288935, 138.31224912282173, 207.83607005394632], [39.3489581926417, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [45.26281355546354, 90, 148.18162895123632, 149.06120979834316, 207.83607005394632], [43.195924463803394, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [51.42698065294191, 90, 359.9224751621648, 138.31224912282173, 220.2466354493924], [41.53119200792531, 270, 317.55027797677104, 138.31224912282173, 220.2466354493924], [51.19323460481004, 90, 141.7532930288935, 138.31224912282173, 207.83607005394632], [41.57611951651307, 90, 107.67299290071347, 138.31224912282173, 173.7530751333942], [44.64720864006623, 90, 270.6136265017543, 138.31224912282173, 207.83607005394632], [39.50308113457197, 270, 129.82109359089375, 138.31224912282173, 220.2466354493924], [47.00676291990361, 90, 246.11046163930618, 138.31224912282173, 220.2466354493924], [47.320815854567904, 90, 200.45608813037416, 138.31224912282173, 207.83607005394632], [40.63522187527589, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [41.132804534065535, 90, 317.55027797677104, 138.31224912282173, 207.83607005394632], [45.26281355546354, 90, 359.9224751621648, 138.31224912282173, 207.83607005394632], [39.50308113457197, 90, 141.66329206675354, 149.06120979834316, 207.83607005394632], [50.06269549457686, 270, 359.9224751621648, 138.31224912282173, 207.83607005394632], [40.2692243165155, 90, 253.81497334708092, 138.31224912282173, 220.2466354493924], [41.391144384753865, 90, 339.87548238045, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 178.9938184455392, 138.31224912282173, 220.2466354493924], [43.482764823913826, 90, 91.92839369677222, 138.31224912282173, 220.2466354493924], [39.773877926725525, 270, 187.11494558078422, 138.31224912282173, 220.2466354493924], [40.3269303034353, 270, 25.654015355228527, 138.31224912282173, 207.83607005394632], [43.98988457719641, 90, 76.0365543609157, 138.31224912282173, 220.2466354493924], [40.28331947553764, 90, 148.18162895123632, 138.31224912282173, 220.2466354493924], [40.564011109396475, 90, 30.150939221833024, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 30.150939221833024, 138.31224912282173, 207.83607005394632], [43.25435455736001, 90, 351.23054315098483, 138.31224912282173, 207.83607005394632], [41.5933910386235, 90, 123.24667687266606, 138.31224912282173, 220.2466354493924], [39.79277402341765, 270, 290.5626421992111, 138.31224912282173, 220.2466354493924], [43.454168182601904, 90, 270.6136265017543, 138.31224912282173, 220.2466354493924], [41.132804534065535, 90, 270.6136265017543, 232.23806646878214, 207.83607005394632], [39.773877926725525, 90, 280.54317392895234, 138.31224912282173, 220.2466354493924], [41.45885901373828, 90, 120.44351271745137, 138.31224912282173, 220.2466354493924], [44.66004862110185, 270, 141.7532930288935, 138.31224912282173, 220.2466354493924], [42.92799003583317, 90, 155.59155320484882, 138.31224912282173, 173.7530751333942], [49.5419223218604, 90, 200.45608813037416, 138.31224912282173, 220.2466354493924], [39.50308113457197, 270, 294.9019593804165, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 203.607796848344, 138.31224912282173, 220.2466354493924], [44.96619292871524, 90, 14.71588636008045, 138.31224912282173, 207.83607005394632], [39.739368538137356, 270, 178.61746189359863, 138.31224912282173, 220.2466354493924], [45.26281355546354, 270, 187.11494558078422, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 189.2304463252818, 138.31224912282173, 220.2466354493924], [40.2692243165155, 90, 256.83023125310723, 185.4581842397622, 168.6433793263243], [42.77704573677643, 90, 325.89860246183093, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 209.22649560836288, 149.06120979834316, 207.83607005394632], [39.773877926725525, 270, 38.308047188798476, 138.31224912282173, 220.2466354493924], [47.00676291990361, 90, 290.5626421992111, 149.06120979834316, 220.2466354493924], [44.20118596602477, 90, 178.9938184455392, 138.31224912282173, 207.83607005394632], [45.26281355546354, 90, 354.30244703056303, 149.06120979834316, 207.83607005394632], [41.57611951651307, 270, 314.79525755502385, 149.06120979834316, 220.2466354493924], [45.26281355546354, 270, 178.24140134085545, 149.06120979834316, 207.83607005394632], [47.50174042513552, 90, 30.150939221833024, 138.31224912282173, 207.83607005394632], [41.391144384753865, 90, 60.13358615602102, 138.31224912282173, 207.83607005394632], [43.15008233051187, 90, 290.5626421992111, 149.06120979834316, 220.2466354493924], [39.773877926725525, 270, 116.58584342547053, 138.31224912282173, 207.83607005394632], [39.773877926725525, 90, 55.18382745013285, 185.4581842397622, 220.2466354493924], [44.96619292871524, 90, 212.38113058787997, 138.31224912282173, 207.83607005394632], [45.095561666686955, 90, 20.087929923010854, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 317.55027797677104, 138.31224912282173, 173.7530751333942], [46.848864267051376, 90, 253.81497334708092, 138.31224912282173, 207.83607005394632], [41.53119200792531, 90, 317.55027797677104, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 141.7532930288935, 138.31224912282173, 220.2466354493924], [39.56571024979391, 90, 273.9104618124061, 149.06120979834316, 220.2466354493924], [50.66520045704306, 90, 14.71588636008045, 138.31224912282173, 220.2466354493924], [39.36066394682889, 270, 153.5871767950164, 138.31224912282173, 220.2466354493924], [47.50174042513552, 90, 114.55552424942502, 149.06120979834316, 207.83607005394632], [49.23641377959692, 90, 227.4059455108632, 138.31224912282173, 220.2466354493924], [39.50308113457197, 90, 227.4059455108632, 138.31224912282173, 220.2466354493924], [39.503772230767, 90, 235.2149251650419, 138.31224912282173, 220.2466354493924], [45.26281355546354, 270, 91.92839369677222, 138.31224912282173, 220.2466354493924], [42.568164556715175, 90, 270.6136265017543, 232.23806646878214, 220.2466354493924], [39.39147685457711, 270, 209.22649560836288, 138.31224912282173, 220.2466354493924], [40.7225549045425, 90, 220.62384635128473, 138.31224912282173, 207.83607005394632], [48.05595860374863, 90, 109.37666018360338, 138.31224912282173, 207.83607005394632], [39.39147685457711, 270, 209.22649560836288, 138.31224912282173, 220.2466354493924], [39.773877926725525, 90, 359.9224751621648, 138.31224912282173, 220.2466354493924]]
    scores = [0 for col in range(item_size)]
    scores = cal(group, scores)
    print("==== init scores:", scores)
    print("---------------- finish GA init ----------------")
    return [group, scores]


def choose(group, scores):
    new_group = [[0 for col in range(5)] for row in range(item_size)]
    p_choose = [0 for col in range(item_size)]
    min_scores = min(scores)
    for i in range(item_size):
        scores[i] -= min_scores
    sum_score = sum(scores)
    accumulate = 0
    # 轮盘 init
    for i in range(item_size):
        accumulate += scores[i]
        p_choose[i] = accumulate / sum_score

    # 轮盘 do
    for i in range(item_size-2):
        rand_num = random.random()
        for j in range(item_size):
            if rand_num <= p_choose[j]:
                new_group[i][:] = group[j][:]
                break

    # 保留最优解，一个不动，两个参与交叉变异
    best_item = group[scores.index(max(scores))][:]
    new_group[item_size-1][:] = best_item
    new_group[item_size-2][:] = best_item
    return [best_item, new_group]


def cross(group):
    for i in range(int(item_size/2)):
        if random.random()>cross_rate:
            continue
        num_a = i*2
        num_b = i*2+1
        temp_pos1 = random.randint(0, 4)
        temp_pos2 = random.randint(0, 4)
        pos1 = min(temp_pos1, temp_pos2)
        pos2 = max(temp_pos1, temp_pos2)

        temp = group[num_a][pos1:pos2+1]
        group[num_a][pos1:pos2+1] = group[num_b][pos1:pos2+1]
        group[num_b][pos1:pos2+1] = temp
    return group


def variation(group):
    times = int(item_size * variation_rate)
    for i in range(times):
        num = random.randint(0, item_size-1)
        pos = random.randint(0, 4)
        if (pos == 0):
            group[num][pos] = random.random()*13+39.24
        elif (pos == 1):
            group[num][pos] = (group[num][pos]+180)%360
        elif (pos == 2):
            group[num][pos] = random.random()*360
        elif (pos == 3 | pos == 4):
            group[num][pos] = random.random()*360
    return group


def main_ga():
    [group, scores] = init()
    best_scores = [0 for col in range(gen+1)]
    ave_scores = [0 for col in range(gen+1)]
    best_items = [[0 for col in range(5)] for row in range(gen+1)]
    best_scores[0] = max(scores)
    ave_scores[0] = np.mean(scores)
    best_items[0][:] = group[scores.index(max(scores))][:]
    print("---------------- begin GA ----------------")
    for i in range(gen):
        print(i, "================================================")
        # 选择
        [best_item, group] = choose(group, scores)
        # 交叉
        group = cross(group)
        # 变异
        group = variation(group)
        # take best
        group[item_size-1][:] = best_item
        # 适应度
        scores = cal(group, scores)
        # record & print
        best_scores[i+1] = max(scores)
        ave_scores[i+1] = np.mean(scores)
        best_items[i+1][:] = group[scores.index(max(scores))][:]
        print(best_scores[i+1])
        print(ave_scores[i+1])
        print(best_items[i+1][:])
        print("================================================\n\n")
        print((best_scores[i+1]-ave_scores[i+1])/best_scores[i+1]*100, "%")
        if (best_scores[i+1]-ave_scores[i+1])/best_scores[i+1]*100 < 5.3:
            break
        

    endTime = time.time()
    print("time: ", endTime - startTime)
    return [best_scores, ave_scores, best_items, endTime]
    


[best_scores, ave_scores, best_items, endTime] = main_ga()

# 火焰图
# pr.disable()
# pr.dump_stats("C:\\ProgramData\\Anaconda3\\Lib\\site-packages\\__pycache__\\request.prof")
# pr.dump_stats("request.prof")
# s = io.StringIO()
# sortby = "cumtime"  # 仅适用于 3.6, 3.7 把这里改成常量了
# ps = pstats.Stats(pr, stream=s).sort_stats(sortby)
# ps.print_stats()
# print(s.getvalue())


# plot
fig1 = plt.figure(1)
plt.plot(best_scores)
plt.xlabel('gen')
plt.ylabel('best_score')
plt.title('best_score of GA')
fig1.savefig('ga3s1c_best_back.png')

fig2 = plt.figure(2)
plt.plot(ave_scores)
plt.xlabel('gen')
plt.ylabel('average_score')
plt.title('average_score of GA')
fig2.savefig('ga3s1c_average_back.png')

print("================================")
print("best: ", best_scores)
print("ave: ", ave_scores)
print("items: ", best_items)
plt.show()

txtStr = "ga3s1c_back.txt"
myFo = open(txtStr, "w")

myFo.write("time_cost\n")
myFo.write(str(endTime - startTime))
myFo.write("\n")
myFo.write("best_score\n")
myFo.write(str(best_scores))
myFo.write("\n")
myFo.write("ave_score\n")
myFo.write(str(ave_scores))
myFo.write("\n")
myFo.write("best_items\n")
myFo.write(str(best_items))

myFo.close()

# 火焰图执行步骤
# python -m cProfile -s cumtime ga.py
# cd C:\ProgramData\Anaconda3\Lib\site-packages\__pycache__
# python flameprof.cpython-37.pyc request.prof > c:\stk\requests.svg